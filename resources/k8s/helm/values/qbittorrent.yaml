---
image:
    repository: ghcr.io/linuxserver/qbittorrent
    pullPolicy: IfNotPresent
    tag: version-5.0.3-r0

env:
    TZ: UTC
    PUID: '1000'
    PGID: '1000'

service:
    main:
        ports:
            http:
                port: 8080
    bittorrent:
        enabled: true
        type: LoadBalancer
        ports:
            bittorrent:
                enabled: true
                port: 6881
                protocol: TCP
                targetPort: 6881

ingress:
    main:
        enabled: true
        ingressClassName: nginx
        annotations:
            nginx.ingress.kubernetes.io/backend-protocol: HTTP
            nginx.ingress.kubernetes.io/ssl-redirect: 'true'
        hosts:
            - host: torrent.tqtensor.com
              paths:
                  - path: /
                    pathType: Prefix
        tls:
            - secretName: torrent-tls-secret
              hosts:
                  - torrent.tqtensor.com

persistence:
    config:
        enabled: true
        type: pvc
        accessMode: ReadWriteOnce
        size: 1Gi
        storageClass: scw-bssd
    downloads:
        enabled: true
        type: pvc
        accessMode: ReadWriteMany
        size: 200Gi
        storageClass: nfs-dns

# Liveness probe to detect stale NFS mounts
probes:
    liveness:
        enabled: true
        custom: true
        spec:
            exec:
                command:
                    - ls
                    - /downloads
            initialDelaySeconds: 30
            periodSeconds: 60
            timeoutSeconds: 10
            failureThreshold: 3

# Resource limits (adjust based on usage)
resources:
    requests:
        memory: 256Mi
        cpu: 100m
    limits:
        memory: 1Gi
        cpu: 1000m
